server {
  listen 127.0.0.1:8000;

  server_name localhost;

  root  /srv/bamboo-agent-home/xml-data/build-dir/CORE-GTC-CAT;
  index index.php;
  client_max_body_size 64M;

  location /typo3/install {
    return 307 $scheme://$host/typo3/sysext/install/Start/Install.php;
  }

  # Prevent clients from accessing hidden files (starting with a dot)
  # This is particularly important if you store .htpasswd files in the site hierarchy
  # Access to `/.well-known/` is allowed.
  location ~* /\.(?!well-known\/) {
      deny all;
  }

  # Prevent clients from accessing to backup/config/source files
  location ~* (?:\.(?:bak|conf|dist|fla|in[ci]|log|psd|sh|sql|sw[op])|~)$ {
      deny all;
  }

  # Built-in filename-based cache busting
  location ~* (.+)\.(?:\d+)\.(js|css|png|jpg|jpeg|gif)$ {
    try_files $uri $1.$2;
  }

  location / {
    try_files $uri $uri/ /index.php?$args;
  }

  location ~ \.php$ {
    # regex to split $uri to $fastcgi_script_name and $fastcgi_path
    fastcgi_split_path_info ^(.+\.php)(/.+)$;

    # Check that the PHP script exists before passing it
    try_files $fastcgi_script_name =404;

    # Bypass the fact that try_files resets $fastcgi_path_info
    # see: http://trac.nginx.org/nginx/ticket/321
    set $path_info $fastcgi_path_info;
    fastcgi_param PATH_INFO $path_info;

    fastcgi_index index.php;

    fastcgi_param QUERY_STRING    $query_string;
    fastcgi_param REQUEST_METHOD    $request_method;
    fastcgi_param CONTENT_TYPE    $content_type;
    fastcgi_param CONTENT_LENGTH    $content_length;

    fastcgi_param SCRIPT_FILENAME   $request_filename;
    fastcgi_param SCRIPT_NAME     $fastcgi_script_name;
    fastcgi_param REQUEST_URI     $request_uri;
    fastcgi_param DOCUMENT_URI    $document_uri;
    fastcgi_param DOCUMENT_ROOT   $document_root;
    fastcgi_param SERVER_PROTOCOL   $server_protocol;

    fastcgi_param GATEWAY_INTERFACE CGI/1.1;
    fastcgi_param SERVER_SOFTWARE   nginx/$nginx_version;

    fastcgi_param REMOTE_ADDR     $remote_addr;
    fastcgi_param REMOTE_PORT     $remote_port;
    fastcgi_param SERVER_ADDR     $server_addr;
    fastcgi_param SERVER_PORT     $server_port;
    fastcgi_param SERVER_NAME     $server_name;

    fastcgi_param HTTPS       $https if_not_empty;

    # PHP only, required if PHP was built with --enable-force-cgi-redirect
    fastcgi_param REDIRECT_STATUS   200;

    fastcgi_pass acceptance-tests-fpm;
    fastcgi_read_timeout 90;
  }
}
